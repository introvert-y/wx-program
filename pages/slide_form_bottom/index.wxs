var newmark = startmark = 0
var lastX = 0

function touchstart(e, ins) {
  var instance = e.instance;
  var info = instance.getDataset();
  var state = ins.getState();

  var pageY = (e.touches[0] || e.changedTouches[0]).pageY;
  startmark = newmark = pageY;

  if (!lastX && !state.height) {
    console.log('start 赋值')
    lastX = info.min;
    state.height = info.height;
    state.initHeight = info.init;
    state.minHeight = info.min;
  }

  console.log('start', pageY);
}
function touchmove(e, ins) {
  var state = ins.getState();
  var pageY = (e.touches[0] || e.changedTouches[0]).pageY;
  var newmark = pageY;
  var condition = (state.minHeight <= (state.height - (lastX + newmark - startmark)));
  if (Math.abs(newmark - startmark) < 10) {
    return;
  }

  if (startmark < pageY) {
    if ((state.height > Math.abs(newmark - startmark))) {
      console.log('transform', (lastX + Math.abs(newmark - startmark)));
      ins.selectComponent('.slider_box').setStyle({
        transform: 'translate3d(0, ' + Math.min(state.height, (lastX + Math.abs(newmark - startmark))) + 'px, 0)'
      })
    }
  }
  if (startmark > pageY) {
    ins.selectComponent('.slider_box').setStyle({
      transform: 'translate3d(0, ' + Math.max(0, (lastX - Math.abs(newmark - startmark))) + 'px, 0)'
    })
  }
}
function touchend(e, ins) {
  var pageY = (e.touches[0] || e.changedTouches[0]).pageY
  newmark = pageY
  var state = ins.getState();
  console.log('touchend', Math.abs(newmark - startmark));
  if (Math.abs(newmark - startmark) < 10) {
    return;
  }

  if (startmark < pageY) {
    vins.selectComponent('.slider_box').setStyle({
      transform: 'translate3d(0, ' + Math.min(state.height, Math.floor((lastX + newmark - startmark))) + 'px, 0)'
    })
    lastX += Math.floor(newmark - startmark)
  }
  if (startmark > newmark) {
    ins.selectComponent('.slider_box').setStyle({
      transform: 'translate3d(0, ' +  Math.max(0, Math.floor((lastX - Math.abs(newmark - startmark)))) + 'px, 0)'
    })
    lastX -= Math.abs(newmark - startmark);
    if (lastX >= state.height) {
      lastX === state.height;
      return;
    }
  }
  console.log('last', lastX);
}
module.exports = {
  touchstart: touchstart,
  touchmove: touchmove,
  touchend: touchend
}
